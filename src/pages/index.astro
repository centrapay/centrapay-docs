---
import BaseLayout from '../layouts/BaseLayout.astro';
import FeaturedContentCard from '../components/FeaturedContentCard.astro';
import { getCollection } from '../utils/getCollection';

export async function getStaticPaths() {
  const guides = await getCollection('guides');
  return guides.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

function hydrateGuides(featuredGuides, guides) {
  return featuredGuides.map((guide) => {
    const hydratedGuide = guides.find((g) => g.slug === guide.slug);
    return hydratedGuide;
  });
}

const guides = await getCollection('guides');

const featuredGuides = hydrateGuides([
  { slug: 'payment-flows' },
  { slug: 'farmlands-portal' },
  { slug: 'farmlands-pos-integration' },
], guides);

const featuredContent = [
  {
    href: 'https://docs.centrapay.com/api',
    title: 'API Reference',
    description: 'Powerful, Easy-to-use payment APIs',
    img: '/api-reference-cover.jpg',
  },
];

const description = 'Learn to connect with Centrapay experiences.';
const img = '/homepage-preview.png';
---

<BaseLayout description={description} img={img}>
  <div class="mx-auto my-8 w-full max-w-5xl px-4 sm:px-8">
    <div class="mb-16 flex flex-col space-y-6">
      <h1 class="type-display mb-4">
        <b>Centrapay Docs</b>
      </h1>
      <p class="text-content-secondary">
        Welcome to Centrapay! We enable you to transact fiat currency,
        digital assets and vouchers via your point of sale,
        payment terminal, shopping cart or unattended device. We
        accomplish this via our APIs which allow merchants, customers,
        terminals, and smart wallets to interact with each other.
      </p>
      <p class="text-content-tertiary">
        For more help getting setup, contact us via email at
        <a class="text-interactive-primary underline hover:text-interactive-secondary-hover" href="mailto:integrations@centrapay.com">
          integrations@centrapay.com.
        </a>
      </p>
    </div>
    <div>
      <h2 class="type-headline-2">Featured Docs</h2>
    </div>
    <div class="mt-8 grid gap-4 md:grid-cols-2 lg:gap-6">
      { featuredGuides.map((guide) => (
        <FeaturedContentCard
          title={guide.data.title}
          description={guide.data.description}
          img={guide.data.img}
          slug={guide.slug}
          type="guide"
        />
      ))
      }
      { featuredContent.map((content, index) => (
        <FeaturedContentCard
          title={content.title}
          description={content.description}
          img={content.img}
          href={content.href}
          type="api"
        />
      ))
      }
    </div>
  </div>
</BaseLayout>
