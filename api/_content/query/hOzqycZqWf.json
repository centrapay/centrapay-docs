[{"_path":"/guides/merchant-integration-qr-code-flow","_dir":"guides","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"QR Code Flow for Merchants","description":"Connecting with Patrons using our QR Code Flow requires the merchant integration to create a Payment Request and present a QR Code for the Patron to scan.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connecting with Patrons using our QR Code Flow requires the merchant integration to create a "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests","rel":["nofollow"]},"children":[{"type":"text","value":"Payment Request"}]},{"type":"text","value":" and present a QR Code for the Patron to scan."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The sequence diagram below indicates the expected flow of behaviour between the Patron, the Point of Sale (POS) and Centrapay."}]},{"type":"element","tag":"code","props":{"code":"sequenceDiagram\n    autonumber\n\n    participant P as Patron\n    participant POS\n    participant C as Centrapay\n\n    POS->>C: Create Payment Request\n\n    note over POS: Present QR Code\n\n    P->>POS: Scan QR Code\n\n    par\n        loop\n            POS->>C: Poll for Payment Confirmation\n        end\n\n        P->>C: Pay Payment Request\n    end\n\n    Note over POS: ✅ Display Successful Payment\n    Note over P: ✅ Display Successful Payment\n","language":"mermaid"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sequenceDiagram\n    autonumber\n\n    participant P as Patron\n    participant POS\n    participant C as Centrapay\n\n    POS->>C: Create Payment Request\n\n    note over POS: Present QR Code\n\n    P->>POS: Scan QR Code\n\n    par\n        loop\n            POS->>C: Poll for Payment Confirmation\n        end\n\n        P->>C: Pay Payment Request\n    end\n\n    Note over POS: ✅ Display Successful Payment\n    Note over P: ✅ Display Successful Payment\n"}]}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The POS "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#create-a-payment-request","rel":["nofollow"]},"children":[{"type":"text","value":"creates a Payment Request"}]},{"type":"text","value":" and presents a QR code to the Patron on a customer-facing display."},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The QR code decodes to a URL of the form "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"https://service.centrapay.com/api/payment-requests/{paymentRequestId}/pay"}]}]}]},{"type":"element","tag":"code","props":{"code":"curl -X POST https://service.centrapay.com/api/payment-requests \\\n  -H \"X-Api-Key: $api_key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"configId\": \"5ee168e8597be5002af7b454\",\n    \"value\": {\n      \"amount\": \"10000\",\n      \"currency\": \"NZD\"\n    }\n  }'\n","filename":"Request","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"curl -X POST https://service.centrapay.com/api/payment-requests \\\n  -H \"X-Api-Key: $api_key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"configId\": \"5ee168e8597be5002af7b454\",\n    \"value\": {\n      \"amount\": \"10000\",\n      \"currency\": \"NZD\"\n    }\n  }'\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"{\n  \"configId\": \"5ee168e8597be5002af7b454\",\n  \"createdAt\": \"2021-06-08T04:04:27.426Z\",\n  \"expiresAt\": \"2021-06-08T04:06:27.426Z\",\n  \"expirySeconds\": 120,\n  \"id\": \"MhocUmpxxmgdHjr7DgKoKw\",\n  \"merchantId\": \"26d3Cp3rJmbMHnuNJmks2N\",\n  \"merchantName\": \"Centrapay Café\",\n  \"paymentOptions\": [\n    {\n      \"amount\": \"10000\",\n      \"assetType\": \"centrapay.nzd.main\"\n    }\n  ],\n  \"shortCode\": \"CP-C7F-ZS5\",\n  \"status\": \"new\",\n  \"updatedAt\": \"2021-06-08T04:04:27.426Z\",\n  \"url\": \"https://app.centrapay.com/pay/MhocUmpxxmgdHjr7DgKoKw\",\n  \"value\": {\n    \"currency\": \"NZD\",\n    \"amount\": \"10000\"\n  }\n}\n","filename":"Response","language":"json"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{\n  \"configId\": \"5ee168e8597be5002af7b454\",\n  \"createdAt\": \"2021-06-08T04:04:27.426Z\",\n  \"expiresAt\": \"2021-06-08T04:06:27.426Z\",\n  \"expirySeconds\": 120,\n  \"id\": \"MhocUmpxxmgdHjr7DgKoKw\",\n  \"merchantId\": \"26d3Cp3rJmbMHnuNJmks2N\",\n  \"merchantName\": \"Centrapay Café\",\n  \"paymentOptions\": [\n    {\n      \"amount\": \"10000\",\n      \"assetType\": \"centrapay.nzd.main\"\n    }\n  ],\n  \"shortCode\": \"CP-C7F-ZS5\",\n  \"status\": \"new\",\n  \"updatedAt\": \"2021-06-08T04:04:27.426Z\",\n  \"url\": \"https://app.centrapay.com/pay/MhocUmpxxmgdHjr7DgKoKw\",\n  \"value\": {\n    \"currency\": \"NZD\",\n    \"amount\": \"10000\"\n  }\n}\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The Patron scans the QR code using a Centrapay-enabled app."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The POS "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#get-a-payment-request","rel":["nofollow"]},"children":[{"type":"text","value":"polls the Payment Request for"}]},{"type":"text","value":" Payment Confirmation."},{"type":"element","tag":"code","props":{"code":"curl https://service.centrapay.com/api/payment-requests/MhocUmpxxmgdHjr7DgKoKw \\\n  -H \"Authorization: $jwt\"\n","filename":"Request","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"curl https://service.centrapay.com/api/payment-requests/MhocUmpxxmgdHjr7DgKoKw \\\n  -H \"Authorization: $jwt\"\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"{\n  \"configId\": \"5ee168e8597be5002af7b454\",\n  \"createdAt\": \"2021-06-08T04:04:27.426Z\",\n  \"expiresAt\": \"2021-06-08T04:06:27.426Z\",\n  \"expirySeconds\": 120,\n  \"id\": \"MhocUmpxxmgdHjr7DgKoKw\",\n  \"merchantId\": \"26d3Cp3rJmbMHnuNJmks2N\",\n  \"merchantName\": \"Centrapay Café\",\n  \"paymentOptions\": [\n    {\n      \"amount\": \"10000\",\n      \"assetType\": \"centrapay.nzd.main\"\n    }\n  ],\n  \"shortCode\": \"CP-C7F-ZS5\",\n  \"status\": \"new\",\n  \"updatedAt\": \"2021-06-08T04:04:27.426Z\",\n  \"url\": \"https://app.centrapay.com/pay/MhocUmpxxmgdHjr7DgKoKw\",\n  \"value\": {\n    \"currency\": \"NZD\",\n    \"amount\": \"10000\"\n  }\n}\n","filename":"Response","language":"json"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{\n  \"configId\": \"5ee168e8597be5002af7b454\",\n  \"createdAt\": \"2021-06-08T04:04:27.426Z\",\n  \"expiresAt\": \"2021-06-08T04:06:27.426Z\",\n  \"expirySeconds\": 120,\n  \"id\": \"MhocUmpxxmgdHjr7DgKoKw\",\n  \"merchantId\": \"26d3Cp3rJmbMHnuNJmks2N\",\n  \"merchantName\": \"Centrapay Café\",\n  \"paymentOptions\": [\n    {\n      \"amount\": \"10000\",\n      \"assetType\": \"centrapay.nzd.main\"\n    }\n  ],\n  \"shortCode\": \"CP-C7F-ZS5\",\n  \"status\": \"new\",\n  \"updatedAt\": \"2021-06-08T04:04:27.426Z\",\n  \"url\": \"https://app.centrapay.com/pay/MhocUmpxxmgdHjr7DgKoKw\",\n  \"value\": {\n    \"currency\": \"NZD\",\n    \"amount\": \"10000\"\n  }\n}\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"While the POS continues to poll, the Patron "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#pay-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"pays the Payment Request"}]},{"type":"text","value":" via their Centrapay integrated app. When the Payment Request status is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"paid"}]},{"type":"text","value":", the POS stops polling and displays confirmation of the successful payment."},{"type":"element","tag":"code","props":{"code":"curl -X POST https://service.centrapay.com/api/payment-requests/MhocUmpxxmgdHjr7DgKoKw/pay \\\n  -H \"Authorization: $jwt\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"assetType\": \"centrapay.nzd.main\",\n    \"assetId\": \"WRhAxxWpTKb5U7pXyxQjjY\"\n  }'\n","filename":"Request","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"curl -X POST https://service.centrapay.com/api/payment-requests/MhocUmpxxmgdHjr7DgKoKw/pay \\\n  -H \"Authorization: $jwt\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"assetType\": \"centrapay.nzd.main\",\n    \"assetId\": \"WRhAxxWpTKb5U7pXyxQjjY\"\n  }'\n"}]}]}]},{"type":"element","tag":"code","props":{"code":"{\n  \"activityNumber\": \"2\",\n  \"assetType\": \"centrapay.nzd.main\",\n  \"createdAt\": \"2021-06-08T04:04:27.426Z\",\n  \"createdBy\": \"crn::user:0af834c8-1110-11ec-9072-3e22fb52e878\",\n  \"merchantAccountId\": \"C4QnjXvj8At6SMsEN4LRi9\",\n  \"merchantConfigId\": \"5ee168e8597be5002af7b454\",\n  \"merchantId\": \"26d3Cp3rJmbMHnuNJmks2N\",\n  \"merchantName\": \"Centrapay Café\",\n  \"paymentRequestCreatedBy\": \"crn::user:0af834c8-1110-11ec-9072-3e22fb52e878\",\n  \"paymentRequestId\": \"MhocUmpxxmgdHjr7DgKoKw\",\n  \"shortCode\": \"CP-C7F-ZS5-015\",\n  \"type\": \"payment\",\n  \"value\": {\n    \"currency\": \"NZD\",\n    \"amount\": \"10000\"\n  }\n}\n","filename":"Response","language":"json"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"{\n  \"activityNumber\": \"2\",\n  \"assetType\": \"centrapay.nzd.main\",\n  \"createdAt\": \"2021-06-08T04:04:27.426Z\",\n  \"createdBy\": \"crn::user:0af834c8-1110-11ec-9072-3e22fb52e878\",\n  \"merchantAccountId\": \"C4QnjXvj8At6SMsEN4LRi9\",\n  \"merchantConfigId\": \"5ee168e8597be5002af7b454\",\n  \"merchantId\": \"26d3Cp3rJmbMHnuNJmks2N\",\n  \"merchantName\": \"Centrapay Café\",\n  \"paymentRequestCreatedBy\": \"crn::user:0af834c8-1110-11ec-9072-3e22fb52e878\",\n  \"paymentRequestId\": \"MhocUmpxxmgdHjr7DgKoKw\",\n  \"shortCode\": \"CP-C7F-ZS5-015\",\n  \"type\": \"payment\",\n  \"value\": {\n    \"currency\": \"NZD\",\n    \"amount\": \"10000\"\n  }\n}\n"}]}]}]}]}]}]},"_type":"markdown","_id":"content:guides:merchant-integration-qr-code-flow.md","_source":"content","_file":"guides/merchant-integration-qr-code-flow.md","_extension":"md"},{"_path":"/guides/merchant-payment-conditions","_dir":"guides","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Merchant Payment Conditions","description":"Some Asset Types such as tokens or closed-loop cards may require conditional operator approval. Merchant integrations are required to support Payment Conditions for these asset types in order for them to be accepted for payment.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Some "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/asset-types","rel":["nofollow"]},"children":[{"type":"text","value":"Asset Types"}]},{"type":"text","value":" such as tokens or closed-loop cards may require conditional operator approval. Merchant integrations are required to support "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#payment-condition","rel":["nofollow"]},"children":[{"type":"text","value":"Payment Conditions"}]},{"type":"text","value":" for these asset types in order for them to be accepted for payment."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Examples of Merchant Payment Conditions include:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The merchant needs to confirm proof of identification for age-restricted purchases."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The merchant needs to confirm that a promotional item was purchased."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The patron needs to confirm the payment from their Centrapay integrated app."}]}]},{"type":"element","tag":"section","props":{},"children":[{"type":"element","tag":"h2","props":{"id":"payment-conditions-flow"},"children":[{"type":"text","value":"Payment Conditions Flow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to support Merchant Payment Conditions, the merchant integration must extend Centrapay's payment protocol by "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#create-a-payment-request","rel":["nofollow"]},"children":[{"type":"text","value":"creating the Payment Request"}]},{"type":"text","value":" with the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"conditionsEnabled"}]},{"type":"text","value":" flag set to true."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The example flow below assumes that the merchant integration has first connected with the Patron when "},{"type":"element","tag":"a","props":{"href":"/guides/requesting-payment"},"children":[{"type":"text","value":"Requesting Payment"}]},{"type":"text","value":" using the "},{"type":"element","tag":"a","props":{"href":"/guides/merchant-integration-qr-code-flow"},"children":[{"type":"text","value":"QR Code Flow for Merchants"}]},{"type":"text","value":" or the "},{"type":"element","tag":"a","props":{"href":"https://www.notion.so/Barcode-Flow-for-Merchants-482ac4e5879642378297f3ad17a68b54","rel":["nofollow"]},"children":[{"type":"text","value":"Barcode Flow for Merchants"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"code":"sequenceDiagram\n    autonumber\n\n    participant Patron\n    participant POS\n    participant Centrapay\n\n    Patron->>POS: Connect with Patron\n\n    POS->>Centrapay: Create Payment Request (with conditionsEnabled = true)\n\n    loop Poll for Payment Confirmation\n        POS->>Centrapay: Get Payment Request\n\n        alt Pending Condition Exists\n            note over POS: ❓ Prompt Merchant to Accept or Decline Condition\n            note over Patron: Inform Patron of Condition\n            POS->>Centrapay: Merchant Accepts Condition\n        else Payment Request status is paid\n            note over POS: Stop Polling for Confirmation\n        end\n    end\n\n    note over POS: ✅ Display Successful Payment\n    note over Patron: ✅ Display Successful Payment\n","language":"mermaid"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"sequenceDiagram\n    autonumber\n\n    participant Patron\n    participant POS\n    participant Centrapay\n\n    Patron->>POS: Connect with Patron\n\n    POS->>Centrapay: Create Payment Request (with conditionsEnabled = true)\n\n    loop Poll for Payment Confirmation\n        POS->>Centrapay: Get Payment Request\n\n        alt Pending Condition Exists\n            note over POS: ❓ Prompt Merchant to Accept or Decline Condition\n            note over Patron: Inform Patron of Condition\n            POS->>Centrapay: Merchant Accepts Condition\n        else Payment Request status is paid\n            note over POS: Stop Polling for Confirmation\n        end\n    end\n\n    note over POS: ✅ Display Successful Payment\n    note over Patron: ✅ Display Successful Payment\n"}]}]}]}]},{"type":"element","tag":"section","props":{},"children":[{"type":"element","tag":"h2","props":{"id":"how-to-handle-payment-conditions"},"children":[{"type":"text","value":"How to Handle Payment Conditions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When Payment Conditions are present on a "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#payment-request","rel":["nofollow"]},"children":[{"type":"text","value":"Payment Request"}]},{"type":"text","value":", merchant integrations and consumer apps need to negotiate them with their respective parties using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"status"}]},{"type":"text","value":" of each condition."}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Prompt"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Merchant integrations should prompt the terminal operator to "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#accept-payment-condition-for-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" or "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#decline-payment-condition-for-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"decline"}]},{"type":"text","value":" any conditions that have status "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"awaiting-merchant"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Consumer apps should inform the Patron to "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#accept-payment-condition-for-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"accept"}]},{"type":"text","value":" or "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#decline-payment-condition-for-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"decline"}]},{"type":"text","value":" any conditions that have status "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"awaiting-patron"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Inform"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Merchant integrations should inform the terminal operator of any conditions that have status "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"awaiting-patron"}]},{"type":"text","value":" using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" provided with the condition."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"Consumer apps should inform the Patron of any conditions that have status "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"awaiting-merchant"}]},{"type":"text","value":" using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":" provided with the condition."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Repeat"}]},{"type":"text","value":" the above steps when polling shows conditions have changed."}]}]}]},{"type":"element","tag":"section","props":{},"children":[{"type":"element","tag":"h2","props":{"id":"additional-payment-condition-behaviours"},"children":[{"type":"text","value":"Additional Payment Condition Behaviours"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The payment request status must always be polled after "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#accept-payment-condition-for-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"accepting"}]},{"type":"text","value":" or "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#decline-payment-condition-for-a-payment-request-experimental","rel":["nofollow"]},"children":[{"type":"text","value":"declining"}]},{"type":"text","value":" a condition as these actions may trigger the additional behaviours below."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Conditions can be linked such that they are added or voided due to state changes on the "},{"type":"element","tag":"a","props":{"href":"https://docs.centrapay.com/api/payment-requests#payment-request","rel":["nofollow"]},"children":[{"type":"text","value":"Payment Request"}]},{"type":"text","value":". Note that accepting or declining a voided condition will fail."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"a","props":{"href":"/guides/patron-not-present"},"children":[{"type":"text","value":"Patron Not Present extension"}]},{"type":"text","value":" may prevent the presentation of conditions that are impossible to satisfy such as checking photo ID."}]}]}]}]},"_type":"markdown","_id":"content:guides:merchant-payment-conditions.md","_source":"content","_file":"guides/merchant-payment-conditions.md","_extension":"md"}]