import{u as C}from"./query.211db787.js";import{c as w,h as P,q as g}from"./entry.42ad62d7.js";import{w as _,y as b,A as O,a9 as k,W as D,u as x,F as S,aa as j,G as B,a8 as M,h as N}from"./runtime-core.esm-bundler.5aa44943.js";const A=()=>null;function $(...s){var p;const n=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(n);let[e,l,a={}]=s;if(typeof e!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof l!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");a.server=a.server??!0,a.default=a.default??A,a.lazy=a.lazy??!1,a.immediate=a.immediate??!0;const r=C(),d=()=>r.isHydrating?r.payload.data[e]:r.static.data[e],c=()=>d()!==void 0;r._asyncData[e]||(r._asyncData[e]={data:_(d()??((p=a.default)==null?void 0:p.call(a))??null),pending:_(!c()),error:_(r.payload._errors[e]?w(r.payload._errors[e]):null)});const i={...r._asyncData[e]};i.refresh=i.execute=(t={})=>{if(r._asyncDataPromises[e]){if(t.dedupe===!1)return r._asyncDataPromises[e];r._asyncDataPromises[e].cancelled=!0}if(t._initial&&c())return d();i.pending.value=!0;const o=new Promise((u,f)=>{try{u(l(r))}catch(m){f(m)}}).then(u=>{if(o.cancelled)return r._asyncDataPromises[e];a.transform&&(u=a.transform(u)),a.pick&&(u=z(u,a.pick)),i.data.value=u,i.error.value=null}).catch(u=>{var f;if(o.cancelled)return r._asyncDataPromises[e];i.error.value=u,i.data.value=O(((f=a.default)==null?void 0:f.call(a))??null)}).finally(()=>{o.cancelled||(i.pending.value=!1,r.payload.data[e]=i.data.value,i.error.value&&(r.payload._errors[e]=w(i.error.value)),delete r._asyncDataPromises[e])});return r._asyncDataPromises[e]=o,r._asyncDataPromises[e]};const y=()=>i.refresh({_initial:!0}),v=a.server!==!1&&r.payload.serverRendered;{const t=x();if(t&&!t._nuxtOnBeforeMountCbs){t._nuxtOnBeforeMountCbs=[];const u=t._nuxtOnBeforeMountCbs;t&&(k(()=>{u.forEach(f=>{f()}),u.splice(0,u.length)}),D(()=>u.splice(0,u.length)))}v&&r.isHydrating&&c()?i.pending.value=!1:t&&(r.payload.serverRendered&&r.isHydrating||a.lazy)&&a.immediate?t._nuxtOnBeforeMountCbs.push(y):a.immediate&&y(),a.watch&&b(a.watch,()=>i.refresh());const o=r.hook("app:data:refresh",u=>{if(!u||u.includes(e))return i.refresh()});t&&D(o)}const h=Promise.resolve(r._asyncDataPromises[e]).then(()=>i);return Object.assign(h,i),h}function z(s,n){const e={};for(const l of n)e[l]=s[l];return e}const E=S({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(s){const{path:n,only:e,without:l,where:a,sort:r,limit:d,skip:c,locale:i,find:y}=j(s),v=B(()=>{var t;return(t=n.value)==null?void 0:t.includes("/_")});b(()=>s,()=>p(),{deep:!0});const{data:h,refresh:p}=await $(`content-query-${P(s)}`,()=>{let t;return n.value?t=g(n.value):t=g(),e.value&&(t=t.only(e.value)),l.value&&(t=t.without(l.value)),a.value&&(t=t.where(a.value)),r.value&&(t=t.sort(r.value)),d.value&&(t=t.limit(d.value)),c.value&&(t=t.skip(c.value)),i.value&&(t=t.where({_locale:i.value})),y.value==="one"?t.findOne():y.value==="surround"?n.value?t.findSurround(n.value):(console.warn("[Content] Surround queries requires `path` prop to be set."),console.warn("[Content] Query without `path` will return regular `find()` results."),t.find()):t.find()});return{isPartial:v,data:h,refresh:p}},render(s){var f;const n=M(),{data:e,refresh:l,isPartial:a,path:r,only:d,without:c,where:i,sort:y,limit:v,skip:h,locale:p,find:t}=s,o={path:r,only:d,without:c,where:i,sort:y,limit:v,skip:h,locale:p,find:t};if(o.find==="one"){if(!e&&(n!=null&&n["not-found"]))return n["not-found"]({props:o,...this.$attrs});if(n!=null&&n.empty&&(e==null?void 0:e._type)==="markdown"&&!((f=e==null?void 0:e.body)!=null&&f.children.length))return n.empty({props:o,...this.$attrs})}else if((!e||!e.length)&&n!=null&&n["not-found"])return n["not-found"]({props:o,...this.$attrs});return n!=null&&n.default?n.default({data:e,refresh:l,isPartial:a,props:o,...this.$attrs}):((m,q)=>N("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:m,data:q},null,2)))("default",{data:e,props:o,isPartial:a})}}),T=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"}));export{T as C,E as _,$ as u};
